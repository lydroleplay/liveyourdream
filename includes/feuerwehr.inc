#include <extfire_0.4>

enum e_BurnSpot {
	BS_sName[64],
	Float:BS_fX,
	Float:BS_fY,
	Float:BS_fZ
}

enum e_BurnPosition {
	BP_iBurnSpot,
	Float:BP_fX,
	Float:BP_fY,
	Float:BP_fZ,
	BP_iFlame
}

new const g_BurnSpot[][e_BurnSpot] = {
	{"PainSpray nähe der Pizzaria in Los Santos",2058.7249,-1831.0432,13.5469},
	{"Baumbrand an der Los Santos Stadthalle",1550.1266,-1609.9069,13.3828},
	{"PainSpray nähe des Burger Shot North",1025.0675,-1029.2715,32.1016},
	{"Bauernfarm in Los Santos",-43.0767,34.3503,3.1172},
	{"24/7 Shop nähe des BSN in Los Santos",1315.6230,-901.5963,39.5585},
	{"Buschbrand nähe der Los Santos Zentralbank",1376.0939,-1070.5179,26.1925},
	{"Tankstelle an der Los Santos Landstraße",-81.9452,-1184.2026,1.7500},
	{"Wohnungsbrand am Hauptammunation in Los Santos",}
};

new const g_BurnPosition[][e_BurnPosition] = {
	{0,2072.4617,-1823.3053,13.5469,-1},
	{0,2072.4617,-1823.3053,14.7542,-1},
	{0,2072.2322,-1824.8021,13.5469,-1},
	{0,2072.2322,-1824.8021,15.2614,-1},
	{0,2072.3459,-1826.2922,13.5469,-1},
	{0,2072.3459,-1826.2922,15.3201,-1},
	{0,2072.3147,-1828.1403,13.5469,-1},
	{0,2072.3147,-1828.1403,15.0619,-1},
	{0,2072.1785,-1833.9106,13.5545,-1},
	{0,2072.1785,-1833.9106,14.8803,-1},
	{0,2072.2114,-1836.0856,14.8803,-1},
	{0,2072.3689,-1837.4307,14.8803,-1},
	{0,2072.1614,-1838.5114,14.8803,-1},
	{0,2072.0945,-1838.8602,13.5545,-1},
	{0,2072.2256,-1837.8840,13.5545,-1},
	{0,2072.2256,-1836.7633,13.5545,-1},
	{0,2072.6621,-1834.7729,13.5545,-1},
	{0,2071.3069,-1832.6661,13.5469,-1},
	{0,2070.7498,-1831.3646,13.5469,-1},
	{0,2071.2012,-1830.0648,13.5469,-1},
	{0,2069.1892,-1829.6628,13.5469,-1},
	{0,2068.5300,-1830.9246,13.5469,-1},
	{0,2068.5603,-1832.7316,13.5469,-1},
	{0,2066.0374,-1833.9392,13.5469,-1},
	{0,2065.4968,-1830.2094,13.5469,-1},
	{0,2065.6846,-1828.5924,13.5469,-1},
	{0,2060.2151,-1831.1823,13.5469,-1},
	{0,2061.6926,-1833.3075,13.5469,-1},
	{0,2064.3787,-1832.2689,13.5469,-1},
	{0,2061.2158,-1830.0122,13.5469,-1},
	
	{1,1457.8104,-1710.1396,14.5469,-1},
	{1,1457.7025,-1710.0359,16.7888,-1},
	{1,1457.5702,-1709.9193,18.8734,-1},
	{1,1459.7463,-1711.0358,22.2649,-1},
	{1,1455.8733,-1711.2830,22.2649,-1},
	{1,1460.8348,-1708.6282,14.5469,-1},
	{1,1461.1385,-1708.2816,17.6587,-1},
	{1,1460.3837,-1708.2048,21.6441,-1},
	{1,1460.3837,-1708.2048,20.0374,-1},
	{1,1460.4124,-1708.3643,16.1631,-1},
	{1,1463.8068,-1702.2023,14.5469,-1},
	{1,1462.4562,-1701.6909,14.5469,-1},
	{1,1462.4562,-1701.6909,16.0382,-1},
	{1,1463.7272,-1701.9443,16.0382,-1},

	{2,1022.2892,-1030.2147,32.0662,-1},
	{2,1022.2892,-1030.2147,33.6960,-1},
	{2,1022.2892,-1030.2147,34.7557,-1},
	{2,1023.5863,-1029.7627,32.1016,-1},
	{2,1024.9313,-1030.0327,32.0789,-1},
	{2,1026.3446,-1029.6415,32.1016,-1},
	{2,1027.6917,-1030.0574,32.0772,-1},
	{2,1027.6917,-1030.0574,33.9377,-1},
	{2,1027.6917,-1030.0574,34.5308,-1},
	{2,1027.6392,-1030.2781,35.8920,-1},
	{2,1026.1362,-1030.4834,35.8920,-1},
	{2,1024.6163,-1030.2153,35.8920,-1},
	{2,1023.2636,-1030.2474,35.8920,-1},
	{2,1021.8826,-1030.1531,35.8920,-1},
	{2,1022.9129,-1026.8071,32.1016,-1},
	{2,1022.7258,-1023.9760,32.1016,-1},
	{2,1024.5581,-1023.2062,32.1016,-1},
	{2,1026.3564,-1023.2383,32.1016,-1},
	{2,1026.8945,-1024.4000,32.1016,-1},
	{2,1027.1708,-1026.1061,32.1016,-1},
	{2,1025.6266,-1027.1625,32.1016,-1},
	{2,1024.3716,-1027.2386,32.1016,-1},
	{2,1022.5672,-1020.7379,32.1016,-1},
	{2,1025.6785,-1019.5777,32.1016,-1},
	{2,1027.6255,-1019.7916,32.1016,-1},
	{2,1020.9613,-1029.9719,32.0832,-1},
	{2,1020.9613,-1029.9719,33.5670,-1},
	{2,1020.9613,-1029.9719,34.7488,-1},
	{2,1020.9613,-1029.9719,35.5329,-1},
	{2,1029.6792,-1030.1489,32.0708,-1},
	{2,1029.6792,-1030.1489,34.0332,-1},
	{2,1029.6792,-1030.1489,35.2961,-1},

	{3,-32.8249,48.9681,3.1172,-1},
	{3,-33.3060,47.5854,3.1172,-1},
	{3,-33.9354,45.7836,3.1172,-1},
	{3,-34.6502,43.7335,3.1172,-1},
	{3,-35.1823,42.2068,3.1172,-1},
	{3,-35.6422,40.8933,3.1172,-1},
	{3,-36.1401,39.4686,3.1172,-1},
	{3,-36.6204,38.0922,3.1172,-1},
	{3,-37.2505,36.2867,3.1172,-1},
	{3,-37.9578,34.2596,3.1172,-1},
	{3,-38.4345,32.8937,3.1172,-1},
	{3,-38.4355,33.1021,4.3853,-1},
	{3,-37.7098,35.1405,4.3853,-1},
	{3,-36.6724,38.1724,4.3853,-1},
	{3,-35.4643,41.4769,4.3853,-1},
	{3,-34.3249,44.8635,4.3853,-1},
	{3,-32.9510,48.6103,4.3853,-1},
	{3,-40.1680,27.9229,3.1094,-1},
	{3,-40.7275,26.3227,3.1172,-1},
	{3,-41.2497,24.8262,3.1172,-1},
	{3,-41.2497,24.8262,4.2783,-1},
	{3,-40.5174,27.6476,4.2783,-1},
	{3,-40.2347,28.2864,4.2783,-1},

	{4,1312.2825,-898.1930,39.5781,-1},
	{4,1313.8726,-898.1981,39.5781,-1},
	{4,1311.0142,-898.0467,39.5781,-1},
	{4,1309.1014,-898.0983,39.5781,-1},
	{4,1307.5609,-898.1318,39.5781,-1},
	{4,1305.9055,-898.1360,39.578,-1},
	{4,1305.9055,-898.1360,41.4275,-1},
	{4,1307.2855,-898.1763,41.4275,-1},
	{4,1309.2021,-898.1776,41.4275,-1},
	{4,1310.7548,-898.2205,41.4275,-1},
	{4,1313.2434,-898.2368,41.4275,-1},
	{4,1316.8407,-898.1318,39.5781,-1},
	{4,1318.0830,-898.1125,39.5781,-1},
	{4,1319.7113,-898.1559,39.5781,-1},
	{4,1321.1368,-897.9781,39.5781,-1},
	{4,1322.3351,-898.0102,39.5781,-1},
	{4,1323.7175,-898.0471,39.5781,-1},
	{4,1324.8838,-898.0783,39.5781,-1},
	{4,1325.3074,-898.0896,41.1591,-1},
	{4,1323.3435,-897.8921,41.1591,-1},
	{4,1321.8577,-898.0858,41.1591,-1},
	{4,1319.4576,-898.0256,41.1591,-1},
	{4,1317.7203,-898.0056,41.1591,-1},
	{4,1309.1594,-903.6898,40.5781,-1},
	{4,1309.6494,-904.8565,39.4228,-1},
	{4,1309.5400,-905.7908,39.4228,-1},
	{4,1308.2577,-905.2819,39.4228,-1},
	{4,1308.3165,-903.6739,39.4228,-1},
	{4,1307.4828,-903.9948,39.4228,-1},
	{4,1307.9412,-907.1920,39.4228,-1},
	
    	{5,1372.8193,-1084.8542,24.8683,-1},
    	{5,1373.9330,-1082.1970,25.1431,-1},
    	{5,1374.6904,-1079.2948,25.4304,-1},
    	{5,1375.5271,-1075.9352,25.7622,-1},
    	{5,1376.2551,-1072.3856,26.0724,-1},
   	{5,1376.8660,-1068.1407,26.3533,-1},
    	{5,1377.2078,-1065.2225,26.5469,-1},
    	{5,1378.8722,-1064.0242,27.4155,-1},
    	{5,1379.1343,-1066.5675,27.4530,-1},
    	{5,1379.0410,-1070.8927,27.4679,-1},
    	{5,1377.6808,-1075.6296,27.4229,-1},
    	{5,1377.0541,-1079.0137,27.4170,-1},
    	{5,1375.3606,-1084.0865,27.4033,-1},
    	{5,1376.7313,-1084.6433,27.3912,-1},
    	{5,1379.5449,-1084.7806,27.3852,-1},
    	{5,1380.4066,-1082.7333,27.4134,-1},
    	{5,1380.4115,-1078.9354,27.4218,-1},
    	{5,1379.6694,-1066.0863,27.4883,-1},
   	{5,1380.5101,-1062.6619,27.4385,-1},
    	{5,1380.1212,-1059.9554,27.4791,-1},
    	{5,1380.0970,-1058.0704,27.4884,-1},
    	{5,1379.7469,-1054.1677,27.4424,-1},
    	{5,1380.3601,-1052.7719,27.4723,-1},
    	{5,1378.5171,-1051.9890,26.9338,-1},
    	{5,1378.1481,-1054.9917,26.9651,-1},
    	{5,1377.9724,-1058.1429,26.8805,-1},
    	{5,1377.6107,-1061.7638,26.7762,-1},
    	{5,1379.0109,-1064.0756,30.8215,-1},
    	{5,1376.8104,-1078.4911,30.8217,-1},
    	{5,1379.3649,-1053.6681,30.4915,-1},
	
    	{6,-104.4137,-1172.9299,2.6539,-1},
    	{6,-110.2088,-1182.5492,2.6953,-1},
    	{6,-98.0744,-1173.5760,2.3867,-1},
    	{6,-96.5481,-1171.4370,2.4991,-1},
    	{6,-90.9467,-1176.1525,2.1837,-1},
    	{6,-89.5463,-1174.4746,2.3594,-1},
    	{6,-86.0950,-1164.7548,2.2475,-1},
    	{6,-84.6313,-1163.5500,2.3359,-1},
    	{6,-93.3165,-1161.4995,2.2200,-1},
    	{6,-93.2618,-1163.4133,2.4453,-1},
    	{6,-99.0015,-1173.0702,6.7853,-1},
    	{6,-98.5346,-1171.6503,6.7853,-1},
    	{6,-97.9884,-1170.2064,6.7853,-1},
    	{6,-97.1701,-1168.3978,6.7853,-1},
    	{6,-96.5919,-1167.0059,6.7853,-1},
   	{6,-95.8733,-1165.2041,6.7853,-1},
    	{6,-94.8334,-1163.3346,6.7853,-1},
    	{6,-94.2085,-1161.6035,6.7853,-1},
    	{6,-93.4416,-1159.8529,6.7853,-1},
    	{6,-78.7051,-1164.4711,2.0802,-1},
    	{6,-84.1655,-1181.7006,1.8762,-1},
    	{6,-98.9805,-1174.5007,6.3922,-1},
    	{6,-97.5220,-1175.0275,6.3922,-1},
    	{6,-96.3135,-1175.6334,6.3922,-1},
    	{6,-95.0837,-1176.1305,6.3922,-1},
    	{6,-93.8933,-1176.6234,6.3922,-1},
    	{6,-92.2185,-1177.3622,6.3922,-1},
    	{6,-90.3665,-1178.1791,6.3922,-1},
    	{6,-88.8814,-1178.6958,6.3922,-1},

	{7,1333.1084,-1366.4666,18.8766,-1},
	{7,1332.9995,-1363.0088,18.8766,-1},
	{7,1332.9625,-1361.6653,18.8766,-1},
	{7,1332.7728,-1358.2080,18.8766,-1},
	{7,1333.1770,-1356.1056,18.8766,-1},
	{7,1333.0516,-1354.6793,18.8766,-1},
	{7,1332.9600,-1351.5175,18.8766,-1},
	{7,1332.9713,-1347.9832,18.8766,-1},
	{7,1332.9121,-1349.0958,18.8766,-1},
	{7,1333.0502,-1355.5530,14.0014,-1},
	{7,1332.8645,-1357.4004,14.0014,-1}
};
new tFeuerwehr;
new iBurnSpot;
new iBurnIcon;
new tFeuerwehrCancel;


stock InitFeuerwehr() {
	//tFeuerwehr = SetTimer("Pulse_Feuerwehr",  60521 *  ( 8 + random(16) ) , false );
	tFeuerwehr = SetTimer("Pulse_Feuerwehr",  60521 , false );
	ExtFire_Init();
	return 1;
}

stock CloseFeuerwehr() {
    ExtFire_Close();
    return 1;
}

forward Pulse_Feuerwehr();
public Pulse_Feuerwehr() {
	new
	    count,
	    String[128];
	KillTimer(tFeuerwehr);
	for(new i ; i < MAX_PLAYERS ; i++ ) {
	    if(Spieler[i][pFraktion] == 3 ) {
	        count = 50;
	        break;
	    }
	}
	if(!count) {
		tFeuerwehr = SetTimer("Pulse_Feuerwehr",  60521 *  ( 5 + random(6) ) , false );
	    return 0;
	}
	tFeuerwehrCancel = SetTimer("FeuerwehrAbbruch",8*60*1000,false);
	
	iBurnSpot = random( sizeof(g_BurnSpot) );
	format(String,sizeof(String),"Eine Feuer ist ausgebrochen! Ort: %s",g_BurnSpot[iBurnSpot][BS_sName]);
	SendFraktionMessage(3, COLOR_RED, String);
	iBurnIcon = CreateDynamicMapIconEx( g_BurnSpot[iBurnSpot][BS_fX] , g_BurnSpot[iBurnSpot][BS_fY] , g_BurnSpot[iBurnSpot][BS_fZ] ,20,0,MAPICON_GLOBAL , 1000.0 );
	/*
	for(new i ; i < MAX_PLAYERS ; i++ ) {
	    if(Spieler[i][pFraktion] == 3 ) {
			Streamer_AppendArrayData(STREAMER_TYPE_MAP_ICON,iBurnIcon,E_STREAMER_PLAYER_ID,i);
	    }
	}
	*/
	for(new i ; i < sizeof(g_BurnPosition) ; i++) {
	    if( iBurnSpot == g_BurnPosition[i][BP_iBurnSpot] ) {
	        g_BurnPosition[i][BP_iFlame] = AddFire( g_BurnPosition[i][BP_fX],g_BurnPosition[i][BP_fY],g_BurnPosition[i][BP_fZ]);
	    }
	}
	return 1;
}

forward FeuerwehrAbbruch();
public FeuerwehrAbbruch() {
	new
	    String[128];
	format(String,sizeof(String),"Sie konnte den Brand nicht rechtzeitig löschen! Brandort war: %s",g_BurnSpot[iBurnSpot][BS_sName]);
	SendClientMessageToAll(COLOR_RED,"Die Feuerwehr hat versagt!");
	SendClientMessageToAll(COLOR_RED,String);
	RemoveFireSpots();
	tFeuerwehr = SetTimer("Pulse_Feuerwehr",  60521 *  ( 15 + random(26) ) , false );
	DestroyDynamicMapIcon(iBurnIcon);
	print("FeuerwehrAbbruch");
	return 1;
}

stock Feuerwehr_FeuerGeloescht() {
	// Sind noch Flammen offen ?
	new
	    restflammen;
	for(new i = 0; i < MAX_FLAMES; i++)
	{
		if(Flame[i][Flame_Exists]) {
		    restflammen++;
		}
	}
	if(restflammen > 1) {
	    new
	        String[128];
		format(String,sizeof(String),"Eine weitere Feuerquelle wurde gelöscht! Noch %d Flammen offen",restflammen);
		SendFraktionMessage(3, COLOR_ORANGE, String);
	}
	else if(restflammen == 1) {
	    new
	        String[128];
		format(String,sizeof(String),"Nur noch ein Feuer übrig",restflammen);
		SendFraktionMessage(3, COLOR_ORANGE, String);
	}
	else {
	    new
	        String[128];
		format(String,sizeof(String),"Sehr Gute Arbeit! Das Feuer wurde gelöscht (Ort: %s) , +45000$",g_BurnSpot[iBurnSpot][BS_sName]);
		SendFraktionMessage(3, COLOR_GREEN, String );
		format(String,sizeof(String),"Die Feuerwehr konnte den Brand löschen! Brandort war: %s",g_BurnSpot[iBurnSpot][BS_sName]);
		SendClientMessageToAll(COLOR_GREEN,String);
	    KillTimer(tFeuerwehrCancel);
		Kasse[Samd] += 45000;
		RemoveFireSpots();
		tFeuerwehr = SetTimer("Pulse_Feuerwehr",  60521 *  ( 15 + random(21) ) , false );
		DestroyDynamicMapIcon(iBurnIcon);
	}
	return 1;
}


stock RemoveFireSpots() {
	for(new i ; i < sizeof(g_BurnPosition) ; i++) {
	    KillFire( g_BurnPosition[i][BP_iFlame] );
	    g_BurnPosition[i][BP_iFlame] = -1;
	}
	return 1;
}